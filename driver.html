<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªÙˆØµÙŠÙ„</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #212529; color: white; display: flex; align-items: center; justify-content: center; height: 100vh; text-align: center; }
        .success-box { display: none; }
    </style>
</head>
<body>

<div class="container">
    <div id="loading">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>

    <div id="confirmBox" style="display:none;">
        <h3>Ù‡Ù„ Ø³Ù„Ù…Øª Ø§Ù„Ø£ÙˆØ±Ø¯Ø± Ù„Ù„Ø¹Ù…ÙŠÙ„ØŸ</h3>
        <p class="text-muted">Ø§Ø¶ØºØ· Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªØ³Ù„ÙŠÙ… ÙˆØ¥Ø¨Ù„Ø§Øº Ø§Ù„Ù…ÙƒØªØ¨</p>
        <button onclick="confirmDelivery()" class="btn btn-success btn-lg w-100 py-3 fw-bold">âœ… Ø£ÙŠÙˆÙ‡ØŒ ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…</button>
    </div>

    <div id="successBox" class="success-box">
        <h1 style="font-size: 80px;">ðŸŽ‰</h1>
        <h3>Ø§Ù„Ù„Ù‡ ÙŠÙ†ÙˆØ± Ø¹Ù„ÙŠÙƒ!</h3>
        <p>ØªÙ… Ø¥Ø¨Ù„Ø§Øº Ø§Ù„Ù…ÙƒØªØ¨ Ø¥Ù†Ùƒ Ø®Ù„ØµØª.</p>
    </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
  import { getDatabase, ref, update } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-database.js";

  // !!!!!!!!!!!!!! Ù†ÙØ³ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø¨ØªØ§Ø¹Øª Ø§Ù„Ø®Ø·ÙˆØ© 1 Ù‡Ù†Ø§ !!!!!!!!!!!!!!
  // Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyCEBbuudt7RRp0ONywp8oit7TzoWgXo1PI",
  authDomain: "akhdemny-system.firebaseapp.com",
  databaseURL: "https://akhdemny-system-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "akhdemny-system",
  storageBucket: "akhdemny-system.firebasestorage.app",
  messagingSenderId: "831991915916",
  appId: "1:831991915916:web:1267ce815b1a04a6aca2a9"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
  // !!!!!!!!!!!!!! !!!!!!!!!!!!!!

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // Ù†Ø¬ÙŠØ¨ Ø±Ù‚Ù… Ø§Ù„Ø£ÙˆØ±Ø¯Ø± Ù…Ù† Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙØ­Ø©
  const urlParams = new URLSearchParams(window.location.search);
  const orderId = urlParams.get('id');

  if(orderId) {
      document.getElementById('loading').style.display = 'none';
      document.getElementById('confirmBox').style.display = 'block';
  } else {
      document.getElementById('loading').innerHTML = "Ø±Ø§Ø¨Ø· ØºÙŠØ± ØµØ­ÙŠØ­!";
  }

  window.confirmDelivery = function() {
      if(!orderId) return;
      
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© ÙÙŠ Ø§Ù„Ø¯Ø§ØªØ§ Ø¨ÙŠØ²
      update(ref(db, 'orders/' + orderId), {
          status: 'done',
          deliveredAt: Date.now()
      }).then(() => {
          document.getElementById('confirmBox').style.display = 'none';
          document.getElementById('successBox').style.display = 'block';
      }).catch((error) => {
          alert("Ø­Ø¯Ø« Ø®Ø·Ø£ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰");
          console.error(error);
      });
  }
</script>

</body>
</html>
