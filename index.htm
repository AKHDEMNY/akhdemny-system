<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… - Ø§Ø®Ø¯Ù…Ù†ÙŠ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .order-card { background: white; border-radius: 10px; padding: 15px; margin-bottom: 10px; border-right: 5px solid #0d6efd; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .status-new { border-right-color: #0d6efd; }
        .status-done { border-right-color: #198754; background-color: #d1e7dd; }
    </style>
</head>
<body>

<div class="container mt-4">
    <h2 class="text-center mb-4">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø·Ù„Ø¨Ø§Øª - Ø§Ø®Ø¯Ù…Ù†ÙŠ ğŸ›µ</h2>

    <div class="card p-3 mb-4">
        <h5>ğŸ“ Ø¥Ø¶Ø§ÙØ© Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</h5>
        <div class="row g-2">
            <div class="col-md-3"><input type="text" id="clientName" class="form-control" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„"></div>
            <div class="col-md-3"><input type="text" id="clientPhone" class="form-control" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„"></div>
            <div class="col-md-6"><input type="text" id="address" class="form-control" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ø§Ù„ØªÙØµÙŠÙ„"></div>
            <div class="col-md-12"><textarea id="orderDetails" class="form-control" placeholder="ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ (Ù…Ø«Ø§Ù„: 2 Ø´Ø§ÙˆØ±Ù…Ø§ + 1 Ø¨ÙŠØ¨Ø³ÙŠ)"></textarea></div>
            <div class="col-md-4">
                <select id="driverName" class="form-select">
                    <option value="" selected>Ø§Ø®ØªØ± Ø§Ù„Ø·ÙŠØ§Ø±...</option>
                    <option value="Ù…Ø­Ù…Ø¯ (Ø·ÙŠØ§Ø±)">Ù…Ø­Ù…Ø¯ (Ø·ÙŠØ§Ø±)</option>
                    <option value="Ø£Ø­Ù…Ø¯ (Ø·ÙŠØ§Ø±)">Ø£Ø­Ù…Ø¯ (Ø·ÙŠØ§Ø±)</option>
                    <option value="Ø¹Ù„ÙŠ (Ø·ÙŠØ§Ø±)">Ø¹Ù„ÙŠ (Ø·ÙŠØ§Ø±)</option>
                </select>
            </div>
            <div class="col-md-2">
                <button onclick="addOrder()" class="btn btn-primary w-100">Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨</button>
            </div>
        </div>
    </div>

    <h4>ğŸ“¦ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h4>
    <div id="ordersList">
        <p class="text-muted text-center">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª...</p>
    </div>
</div>

<script type="module">
  // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª Ø¨Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ù„Ù„Ù…ØªØµÙØ­
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
  import { getDatabase, ref, push, onValue, update } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-database.js";

  // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase Ø§Ù„Ø®Ø§ØµØ© Ø¨ÙŠÙƒ (ØªÙ… Ø§Ù„ØªØµØ­ÙŠØ­)
  const firebaseConfig = {
    apiKey: "AIzaSyCEBbuudt7RRp0ONywp8oit7TzoWgXo1PI",
    authDomain: "akhdemny-system.firebaseapp.com",
    databaseURL: "https://akhdemny-system-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "akhdemny-system",
    storageBucket: "akhdemny-system.firebasestorage.app",
    messagingSenderId: "831991915916",
    appId: "1:831991915916:web:1267ce815b1a04a6aca2a9"
  };

  // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const SITE_URL = window.location.href.replace('index.html', '');

  window.addOrder = function() {
      const name = document.getElementById('clientName').value;
      const phone = document.getElementById('clientPhone').value;
      const address = document.getElementById('address').value;
      const details = document.getElementById('orderDetails').value;
      const driver = document.getElementById('driverName').value;

      if(!name || !driver) { alert("Ù…Ù† ÙØ¶Ù„Ùƒ Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙˆØ§Ø®ØªØ§Ø± Ø§Ù„Ø·ÙŠØ§Ø±"); return; }

      push(ref(db, 'orders'), {
          clientName: name,
          clientPhone: phone,
          address: address,
          details: details,
          driver: driver,
          status: 'new',
          timestamp: Date.now()
      }).then(() => {
          console.log("ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­");
      }).catch((error) => {
          alert("Ø­Ø¯Ø« Ø®Ø·Ø£: " + error.message);
          console.error(error);
      });

      document.getElementById('clientName').value = '';
      document.getElementById('orderDetails').value = '';
  }

  const ordersList = document.getElementById('ordersList');
  onValue(ref(db, 'orders'), (snapshot) => {
      ordersList.innerHTML = ''; 
      const data = snapshot.val();
      
      if(!data) { ordersList.innerHTML = '<p class="text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</p>'; return; }

      const orders = Object.entries(data).reverse();

      orders.forEach(([id, order]) => {
          const driverLink = `${SITE_URL}driver.html?id=${id}`;
          
          const whatsappMsg = `*Ø§ÙˆØ±Ø¯Ø± Ø¬Ø¯ÙŠØ¯ ÙŠØ§ ${order.driver}* ğŸ›µ%0a` +
                              `ğŸ‘¤ Ø§Ù„Ø¹Ù…ÙŠÙ„: ${order.clientName}%0a` +
                              `ğŸ“ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: ${order.address}%0a` +
                              `ğŸ“ Ù…ÙˆØ¨Ø§ÙŠÙ„: ${order.clientPhone}%0a` +
                              `ğŸ“ Ø§Ù„ØªÙØ§ØµÙŠÙ„: ${order.details}%0a` +
                              `-----------%0a` +
                              `âœ… *Ù„Ù…Ø§ ØªØ³Ù„Ù… Ø§Ù„Ø§ÙˆØ±Ø¯Ø± Ø¯ÙˆØ³ Ù‡Ù†Ø§:*%0a ${driverLink}`;

          const statusClass = order.status === 'done' ? 'status-done' : 'status-new';
          const statusText = order.status === 'done' ? 'âœ… ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„' : 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙˆØµÙŠÙ„';

          const html = `
              <div class="order-card ${statusClass}">
                  <div class="d-flex justify-content-between align-items-center">
                      <div>
                          <strong>#${order.clientName}</strong> - <small>${order.address}</small><br>
                          <span class="text-muted">${order.details}</span><br>
                          <small class="badge bg-secondary">${order.driver}</small>
                      </div>
                      <div class="text-end">
                          <h5 class="${order.status === 'done' ? 'text-success' : 'text-primary'}">${statusText}</h5>
                          ${order.status === 'new' ? 
                            `<a href="https://wa.me/?text=${whatsappMsg}" target="_blank" class="btn btn-success btn-sm">ğŸ“© Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø·ÙŠØ§Ø±</a>` 
                            : ''}
                      </div>
                  </div>
              </div>
          `;
          ordersList.innerHTML += html;
      });
  });
</script>

</body>
</html>
